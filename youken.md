# Flexcord Bot 開発

## 概要
**Flexcord**は、Discord用のカスタマイズ可能なボットプラットフォームで、ユーザーが各ギルド（サーバー）ごとにボットスクリプトを作成・変更できるようにします。ボットは、YAMLスクリプトを使用してコマンドやアクション、レスポンスを定義し、それを解析して実行します。

使用する技術スタック:
- **discord.py**（非同期）
- **PostgreSQL**（非同期）

## 主な機能
- ユーザーはYAML形式のスクリプトを作成し、各ギルドごとにボットの動作をカスタマイズできる。
- スクリプトはPostgreSQLデータベースに保存され、ギルドごとに管理される。
- ボットはスクリプトの変更を検出し、設定を自動的に適用する。
- Webダッシュボードを通じて、ユーザーはリアルタイムでスクリプトの設定変更を行える。
- ユーザーはログやボットの動作状況をダッシュボードで確認できる。

## Copilotへの要求

### 1. ボットのセットアップ（discord.py）
- **discord.py**を使ってボットインスタンスを作成する。
- ボットはコマンドをリスンし、各ギルドの設定に基づいたアクションを実行する。
- メッセージやコマンドを受け取った際に、YAML設定に基づいて動作するようにイベントリスナーを実装する。

### 2. PostgreSQLとの連携
- 非同期で**PostgreSQL**に接続する処理を実装する。
- ギルドごとにスクリプトを保存するテーブルを作成する。
  - テーブルフィールド: `guild_id`、`user_id`、`script_id`、`script_content`、`version`、`last_updated`。
- スクリプトに変更があった場合、ボットが自動でその変更を検知し、適用する仕組みを実装する。

### 3. YAML解析とスクリプト実行
- `pyyaml`または他のYAMLパーサーを使ってYAMLファイルを解析する。
- YAML設定をボットが実行できるアクションに変換する処理を実装する。例えば:
  - `message_response`: トリガーされた際にメッセージを送信する。
  - `role_change`: ユーザーの役職を変更する。
  - `command_action`: 特定のコマンドに対してカスタムアクションを定義する。

### 4. Webダッシュボード（フロントエンド）
- **Next.js**または**React**を使って、ユーザーがDiscord OAuth2でログインできるWebダッシュボードを作成する。
- ユーザーが自分のギルドを選択し、そのギルドのボット設定を管理できるようにする。
- YAMLエディタを実装して、スクリプトの作成・編集ができるようにする。
- 現在のスクリプトバージョンを表示し、保存して適用できるようにする。
- ボットの動作ログを表示し、ユーザーがボットの動作状況やエラーを確認できるようにする。

### 5. ボットの状態管理とログ
- ボットはその動作状況（正常/エラー）を管理する。
- エラーログや動作ログをデータベースに保存し、ダッシュボードで表示できるようにする。
- ボットが動作中に発生したエラーや通知をユーザーに表示する機能を実装する。

---

## YAMLスクリプト例

```yaml
# Flexcordボット用のYAMLスクリプト例

guild_id: "1234567890"
commands:
  hello:
    response: "こんにちは、{user}さん！"
    trigger: "hello"
  set_role:
    response: "{role}の役職が付与されました。"
    trigger: "assign_role"
    action:
      type: "role_change"
      role: "Moderator"
```

このYAMLスクリプトは、2つのアクションを定義します：
1. 「hello」コマンドが入力されると、「こんにちは、{user}さん！」と返答。
2. 「assign_role」コマンドが入力されると、「Moderator」役職を付与。
